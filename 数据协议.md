# 嵌入式校验工具 http://www.ip33.com/crc.html

# 1. 设备合法性确认

## 步骤 1.1: 设备扫描与蓝牙名称验证

应用通过蓝牙扫描附近的设备，并读取每个设备的蓝牙名称和设备 ID。

- 蓝牙名称要求：蓝牙名称必须以 "LIKKIM" 开头，例如 "LIKKIM_0001"。
- 设备 ID 要求：React 应用可以预先存储合法设备的设备 ID 列表或通过服务器查询合法设备 ID。

## 步骤 1.2: 合法性验证

匹配蓝牙名称和设备 ID：React 应用检查设备的蓝牙名称是否以 "LIKKIM" 开头，并验证设备 ID 是否在合法设备 ID 列表中。

- 通过验证：如果蓝牙名称和设备 ID 均合法，应用允许设备连接，并进入下一步验证流程。
- 验证失败：如果验证失败，应用拒绝连接设备。

## 步骤 1.3: 数据协议

### 1. React 应用设备向嵌入式发送蓝牙连接命令：

- 头帧数据: `0xF0`
- 设备连接指令:
  - `0x01` (请求连接)
  - `0x00` (请求不连接)
- 数据长度: `0x03`
- CRC 校验位: 2 字节
- 结尾标志位: `0x0D 0x0A`

### 2. 嵌入式设备向 React 应用蓝牙连接命令：

- 头帧数据: `0xA0`
- 设备名称长度: `0x12`
- 设备名称: `0x4C 0x49 0x4B 0x4B 0x49 0x4D 0x5F 0x57 0x41 0x4C 0x4C 0x45 0x54 0x5F 0x30 0x30 0x30 0x31`
- 服务 UUID: `0x18 0x0D`
- 特性 UUID: `0x2A 0x37`
- 数据长度: `0x18`
- CRC 校验位: 2 字节
- 结尾标志位: `0x0D 0x0A`

# 2. 启动验证码验证

## 步骤 2.1: React 应用向嵌入式设备发送启动验证命令

- 命令内容：React 应用向嵌入式设备发送命令，要求设备生成并发送验证码。
-
- 头帧数据: `0xF1`
- 设备发送验证码:
  - `0x01` (请求连接)
  - `0x00` (请求不连接)
- 数据长度: `0x02`
- CRC 校验位: 2 字节
- 结尾标志位: `0x0D 0x0A`

## 步骤 2.2: 嵌入式设备向 React 应用发送验证码

嵌入式设备接收到启动命令后，使用已实现的算法生成验证码，并通过蓝牙将生成的验证码发送回 React 应用。

- 头帧数据: `0xA1`
- 发送验证码: `0x04 0xD2` (1234 的 16 进制)
- 数据长度: `0x03`
- CRC 校验位: 2 字节
- 结尾标志位: `0x0D 0x0A`

# 3. 应用端验证码匹配

## 步骤 3.1: React 应用向嵌入式设备用户输入验证码

- 用户交互：应用要求用户输入一个他们期望的验证码（可能通过其他渠道获得，比如短信、电子邮件等）。

- 头帧数据: `0xF2`
- 修改验证码请求:
  - `0x01` (请求连接)
  - `0x00` (请求不连接)
- 发送修改验证码: `0x04 0xD2` (1234 的 16 进制)
- 数据长度: `0x04`
- CRC 校验位: 2 字节
- 结尾标志位: `0x0D 0x0A`

## 步骤 3.2: 验证码匹配

- 匹配逻辑：React 应用将用户输入的验证码与嵌入式设备发送回来的验证码进行匹配。

  - 匹配成功：如果两个验证码一致，表示验证成功。
  - 匹配失败：如果验证码不一致，应用断开与设备的蓝牙连接，并提示用户验证失败。(APP 内部完成)

# 4. 验证成功后的确认命令

## 步骤 4.1: React 应用向嵌入式设备发送验证成功命令

- 命令内容：在验证码验证成功后，React 应用向嵌入式设备发送确认命令，告知设备验证成功。

- 头帧数据: `0xFF`
- 确认命令: `0x56 0x45 0x52 0x49 0x46 0x49 0x43 0x41 0x54 0x49 0x4F 0x4E 0x5F 0x53 0x55 0x43 0x43 0x45 0x53 0x53`
- 数据长度: `0x17`
- CRC 校验位: 2 字节
- 结尾标志位: `0x0D 0x0A`

## 步骤 4.2: 嵌入式设备接收确认命令

嵌入式设备接收到 "VERIFICATION_SUCCESS" 命令后，执行验证成功后的操作，如记录状态或启动设备。
